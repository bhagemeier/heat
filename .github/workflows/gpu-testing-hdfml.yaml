name: GPU Testing Workflow on HDFML machine

on:
  push:
    branches:
      - gpu-test-automation

jobs:
  submit-gpu-tests:
    name: Submit GPU test batch job
    runs-on: ubuntu-latest
    steps:
      - uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HDFML_HOST }}
          username: ${{ secrets.HDFML_NAME }}
          key: ${{ secrets.HDFML_KEY }}
          envs: GITHUB_SHA
          script: |
            cd  ~/heat
            git fetch
            git checkout $GITHUB_SHA
            SHA=$GITHUB_SHA
            export SHA
            sbatch .github/workflows/gpu_testing_run.sh
